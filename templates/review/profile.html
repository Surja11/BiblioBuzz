{% extends "base.html" %}
{% block title %}Review Page{% endblock title %}
{% block body %}

  <div class="container" style="color:rgb(237, 235, 227);">
    <div class="d-flex flex-row justify-content-around align-items-center">
    <h1 class="text-center" style="color:#393F46">{{profile.user.username}}</h1>
    <a class="btn  rounded " style="background-color: #393E46;color:#DFD0B8" href="{%url 'editProfile' profile.user_id%}">Edit Profile</a>
    </div>

    <div class= "row" style="color:#393F46">
      <div class="col-md-4 my-3 d-flex flex-column align-items-center ">
      <img src="{{profile.image.url}}" class="img-fluid mt-2" style="max-height: 200px; max-width: 200px; object-fit: contain; border-radius: 50%;"  >
     
      </div>
      <div class="col-md-8 my-3 mt-4">
        <h4 style="color : #393F46">Bio</h4>
        {%if profile.bio%}
        <p style="color:rgb(237, 235, 227);">{{profile.bio}}</p>
        {%else%}
        <p style="color:rgb(237, 235, 227);">No bio. Please click on Edit Profile to add profile</p>
        
        {%endif%}
        
      </div>
    </div>
<hr>
<h3 class="text-center" style="color:#393F46">Your Reviews</h3>
{%if not reviews%}
<div class="alert alert-warning text-center">You have not posted any review yet!</div>
{%endif%}

          {%for review in reviews%}
      <div class="review-card mb-2 p-2 rounded">
        <p class="fw-bold" style="color:#393F46">{{review.book}}</p>
        <span class="fw-bold" style="color:#393F46">{{review.user.username}}</span>
        
        <span class="fw-bold" style="color:#393F46">{{review.rating}} stars</span>
        <p class = "review-text collapsed" id = "review{{forloop.counter}}">{{review.comment}}</p>
        <button class="btn btn-sm" onclick = "toggleReview('review{{forloop.counter}}', this)">Show more</button>

        <div class="d-flex align-items-center mt-2"> 
          <button class="btn btn-sm me-2 " onclick = "likeReview({{review.id}}, this)">üëçLike(<span id="like-count-{{review.id}}">{{review.likes}}</span>)</button>
          <button class="btn btn-sm" onclick="toggleCommentBox({{review.id}})">üí¨Comment</button>
        </div>

        <div id="comment-box-{{review.id}}" style="display:none;">
          <div id="comments-{{review.id}}">
            {% for comment in review.comments.all|slice:":2" %}
              <div class="comment-div border border-light rounded p-2 mb-1 mx-5">
                <span class="fw-bold" style="font-size: 0.8rem; text-decoration: underline;color : #393F46">
                  {{comment.commenter}}
                </span>
                <small class="text-muted">{{comment.created_at|date:"M d, Y"}}</small>
                <p>{{comment.text}}</p>
              </div>
            {% endfor %}
            
            {% if review.comments.count > 2 %}
              <button class="btn btn-link p-0 show-more-btn" 
                      onclick="showMoreComments({{review.id}}, this)"
                      id="show-more-{{review.id}}">
                Show more
              </button>
              <div id="comment-error-{{review.id}}" class="text-danger small" style="display:none;"></div>
            {% endif %}
          </div>

          <form onsubmit="submitComment(event, {{review.id}})">
            <textarea name="comment" class="form-control mb-2" placeholder="Add a comment" required></textarea>
            <button class="btn btn-sm" type="submit">Post</button>
          </form>
        </div>
        <hr>
      </div>
      {%endfor%}
      
      

{% endblock body %}